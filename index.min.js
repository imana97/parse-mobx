"use strict";var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ParseMobx=void 0;var mobx_1=require("mobx");(0,mobx_1.configure)({enforceActions:"observed"});var ParseMobx=function(){function t(e){if(e.isNew())throw new Error("Only Saved Parse objects can be converted to ParseMobx objects.\n            not saved object: ".concat(e.className));this.parseObj=e,this.id=e.id,this.attributes={createdAt:e.get("createdAt")};var r={};for(var n in e.attributes){var o=e.attributes[n];"ParseObjectSubclass"===o.constructor.name?this.attributes[n]=new t(o):Array.isArray(o)?r[n]=o.map((function(e){return"ParseObjectSubclass"===e.constructor.name?new t(e):"ParseRelation"!==e.constructor.name&&"ParseACL"!==e.constructor.name?e:null})):"ParseRelation"!==o.constructor.name&&"ParseACL"!==o.constructor.name&&"createdAt"!==n&&(r[n]=o)}(0,mobx_1.extendObservable)(this.attributes,r)}return t.toParseMobx=function(e){return"function"==typeof e?function(r){return e(new t(r))}:Array.isArray(e)?e.map((function(e){return new t(e)})):e?new t(e):null},t.deleteListItemById=function(t,e){t.splice(t.findIndex((function(t){return t.getId()===e.getId()})),1)},t.updateListItem=function(t,e){t[t.findIndex((function(t){return t.getId()===e.getId()}))]=e},t.prototype.add=function(t,e){return this.checkDefined(t,[]),this.parseObj.add(t,e),this.attributes[t].push(e),this},t.prototype.addAll=function(t,e){return this.checkDefined(t,[]),this.parseObj.addAll(t,e),this.attributes[t]=this.attributes[t].concat(e),this},t.prototype.addAllUnique=function(e,r){var n=this;return this.checkDefined(e,[]),this.checkType(e,"Array")&&r.forEach((function(r){-1===n.attributes[e].indexOf(r)&&("ParseObjectSubclass"===r.constructor.name?n.attributes[e].push(new t(r)):n.attributes[e].push(r))})),this.parseObj.addAllUnique(e,r),this},t.prototype.addUnique=function(e,r){return this.checkDefined(e,[]),this.checkType(e,"Array")&&-1===this.attributes[e].indexOf(r)&&("ParseObjectSubclass"===r.constructor.name?this.attributes[e].push(new t(r)):this.attributes[e].push(r)),this.parseObj.addUnique(e,r),this},t.prototype.clear=function(){return this.parseObj.clear()},t.prototype.clone=function(){return new t(this.parseObj.clone())},t.prototype.destroy=function(t){return this.parseObj.destroy(t)},t.prototype.destroyEventually=function(t){return this.parseObj.destroyEventually(t)},t.prototype.dirty=function(t){return this.parseObj.dirty(t)},t.prototype.dirtyKeys=function(){return this.parseObj.dirtyKeys()},t.prototype.equals=function(t){return this.parseObj.equals(t)},t.prototype.escape=function(t){return this.parseObj.escape(t)},t.prototype.existed=function(){return this.parseObj.existed()},t.prototype.exists=function(t){return this.parseObj.exists(t)},t.prototype.fetch=function(e){var r=this;return new Promise((function(n,o){r.parseObj.fetch(e).then((function(e){return new t(e)})).catch(o)}))},t.prototype.fetchFromLocalDatastore=function(){return this.parseObj.fetchFromLocalDatastore()},t.prototype.fetchWithInclude=function(e,r){var n=this;return new Promise((function(o,i){n.parseObj.fetchWithInclude(e,r).then((function(e){return new t(e)})).catch(i)}))},t.prototype.get=function(t){return this.attributes[t]},t.prototype.getId=function(){return this.id},t.prototype.getACL=function(){return this.parseObj.getACL(arguments)},t.prototype.has=function(t){return this.parseObj.has(t)},t.prototype.increment=function(t,e){return this.checkDefined(t,0),this.checkType(t,"Number")&&(this.attributes[t]+=e||0),this.parseObj.increment(t,e),this},t.prototype.decrement=function(t,e){return this.checkDefined(t,0),this.checkType(t,"Number")&&(this.attributes[t]-=e||0),this.parseObj.decrement(t,e),this},t.prototype.initialize=function(){return this.parseObj.initialize()},t.prototype.isDataAvailable=function(){throw new Error("Method not implemented.")},t.prototype.isNew=function(){return!1},t.prototype.isPinned=function(){throw new Error("Method not implemented.")},t.prototype.isValid=function(){return this.parseObj.isValid()},t.prototype.newInstance=function(){return new t(this.parseObj.newInstance())},t.prototype.op=function(t){return this.parseObj.op(t)},t.prototype.pin=function(){throw new Error("Method not implemented.")},t.prototype.pinWithName=function(t){throw new Error("Method not implemented.")},t.prototype.relation=function(t){return this.parseObj.relation(t)},t.prototype.remove=function(t,e){return this.checkDefined(t,[]),this.checkType(t,"Array")&&-1!==this.attributes[t].indexOf(e)&&this.attributes[t].splice(this.attributes[t].indexOf(e),1),this.parseObj.remove(t,e),this},t.prototype.removeAll=function(t,e){var r=this;return this.checkDefined(t,[]),this.checkType(t,"Array")&&e.forEach((function(e){-1!==r.attributes[t].indexOf(e)&&r.attributes[t].splice(r.attributes[t].indexOf(e),1)})),this.parseObj.removeAll(t,e),this},t.prototype.revert=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this.parseObj.revert(),new t(this.parseObj)},t.prototype.save=function(t){var e=this;return new Promise((function(r,n){e.parseObj.save(t).then((function(){(0,mobx_1.runInAction)((function(){return e.set("updatedAt",(new Date).toISOString(),void 0)})),r(e)})).catch(n)}))},t.prototype.saveEventually=function(t){var e=this;return new Promise((function(r,n){e.parseObj.saveEventually(t).then((function(){(0,mobx_1.runInAction)((function(){return e.set("updatedAt",(new Date).toISOString(),void 0)})),r(e)})).catch(n)}))},t.prototype.set=function(e,r,n){if("ParseRelation"===r.constructor.name)throw new Error("You can not add relations with set");if("ParseACL"===r.constructor.name)throw new Error("Please use setACL() instead");if(void 0!==this.attributes[e])"ParseObjectSubclass"===r.constructor.name?this.attributes[e]=new t(r):this.attributes[e]=r;else{var o={};o[e]=r,(0,mobx_1.extendObservable)(this.attributes,o)}return this.parseObj.set(e,r,n),this},t.prototype.setACL=function(t,e){return this.parseObj.setACL(t,e),this},t.prototype.toJSON=function(){return this.parseObj.toJSON()},t.prototype.toPointer=function(){return this.parseObj.toPointer()},t.prototype.unPin=function(){return this.parseObj.unPin()},t.prototype.unPinWithName=function(t){return this.parseObj.unPinWithName(t)},t.prototype.unset=function(t,e){return this.parseObj.unset(t,e),this.attributes[t]&&delete this.attributes[t],this},t.prototype.validate=function(t,e){return this.parseObj.validate(t,e)},t.prototype.getParseObject=function(){return this.parseObj},t.prototype.checkDefined=function(t,e){if(void 0===this.attributes[t]){var r={};r[t]=e,(0,mobx_1.extendObservable)(this.attributes,r)}},t.prototype.checkType=function(t,e){return this.attributes[t].constructor.name===e},__decorate([mobx_1.action],t.prototype,"add",null),__decorate([mobx_1.action],t.prototype,"addAll",null),__decorate([mobx_1.action],t.prototype,"addAllUnique",null),__decorate([mobx_1.action],t.prototype,"addUnique",null),__decorate([mobx_1.action],t.prototype,"increment",null),__decorate([mobx_1.action],t.prototype,"remove",null),__decorate([mobx_1.action],t.prototype,"removeAll",null),__decorate([mobx_1.action],t.prototype,"revert",null),__decorate([mobx_1.action],t.prototype,"save",null),__decorate([mobx_1.action],t.prototype,"saveEventually",null),__decorate([mobx_1.action],t.prototype,"set",null),t}();exports.ParseMobx=ParseMobx;
